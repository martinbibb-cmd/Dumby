<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dumby ‚Äì Prompt Tree</title>
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./icons/icon-192.png" sizes="192x192">
  <link rel="stylesheet" href="./styles.css?v=5"><!-- bump to bust cache -->
  <link rel="stylesheet" href="./map.css?v=2">
  <style>body{margin:0}</style>
</head>
<body>
  <header class="app-header" style="display:flex;align-items:center;justify-content:space-between;padding:.6rem .9rem;border-bottom:1px solid #2a2a2f;background:#111215;color:#f2f2f2">
    <h1 style="font-size:1.05rem;margin:0">üå≥ Dumby</h1>
    <nav class="view-tabs" role="tablist" aria-label="View mode" style="display:flex;gap:.35rem">
      <button id="tab-list" role="tab" aria-selected="true" data-view="list">List</button>
      <button id="tab-map" role="tab" aria-selected="false" data-view="map">Map</button>
    </nav>
    <div class="actions" style="display:flex;gap:.4rem;flex-wrap:wrap">
      <button id="btn-add">Ôºã Add</button>
      <button id="btn-export">‚¨á JSON</button>
      <label class="file-label">‚¨Ü Import <input id="file-import" type="file" accept="application/json" hidden></label>
      <button id="btn-export-md">üìù MD</button>
      <button id="btn-export-opml">üß† OPML</button>
      <button id="btn-reset">‚Ü∫ Reset</button>
    </div>
  </header>

  <section class="toolbar" style="display:flex;gap:1rem;align-items:center;padding:.6rem .9rem;border-bottom:1px solid #2a2a2f;background:#111215">
    <input id="search" type="search" placeholder="Search title, tags, text‚Ä¶" aria-label="Search"
           style="flex:1;min-width:220px;padding:.55rem .7rem;border-radius:8px;border:1px solid #2a2a2f;background:#0e0f12;color:#f2f2f2">
    <div class="toggles" style="display:flex;gap:1rem;flex-wrap:wrap">
      <label><input id="toggle-compact" type="checkbox" /> Compact</label>
      <label><input id="toggle-dark" type="checkbox" checked /> Dark</label>
      <label><input id="toggle-descriptions" type="checkbox" checked /> Summaries</label>
    </div>
  </section>

  <!-- LIST VIEW (unchanged functionality) -->
  <main id="view-list" class="app" data-view="list" aria-hidden="false">
    <aside class="sidebar">
      <h2>Categories</h2>
      <ul id="category-list" class="category-list" aria-label="Categories"></ul>
      <footer class="meta">
        <div id="stats"></div>
        <div class="version">v2.1</div>
      </footer>
    </aside>
    <section class="content">
      <ul id="tree" class="tree" aria-label="Prompt tree"></ul>
    </section>
  </main>

  <!-- MAP VIEW (new) -->
  <main id="view-map" class="map-wrap" data-view="map" aria-hidden="true">
    <div class="map-toolbar">
      <span>Mind Map</span>
      <div class="map-tools">
        <button id="map-center" title="Center">‚¶ø</button>
        <button id="map-zoom-in" title="Zoom in">Ôºã</button>
        <button id="map-zoom-out" title="Zoom out">Ôºç</button>
        <button id="map-expand" title="Expand all">‚ñæ‚ñæ</button>
        <button id="map-collapse" title="Collapse all">‚ñ∏‚ñ∏</button>
      </div>
    </div>
    <svg id="map-svg" class="map-svg" tabindex="0" aria-label="Mind map canvas"></svg>
    <div id="map-tip" class="map-tip" role="tooltip"></div>
  </main>

  <!-- existing template + dialog from your current file -->
  <template id="prompt-item">
    <li class="node">
      <div class="node-head">
        <button class="collapse" aria-label="Toggle children" title="Toggle">‚ñæ</button>
        <div class="node-text">
          <div class="node-title"></div>
          <div class="node-summary"></div>
        </div>
        <div class="node-actions">
          <button class="copy" title="Copy">Copy</button>
          <button class="edit" title="Edit">Edit</button>
          <button class="delete" title="Delete">Delete</button>
        </div>
      </div>
      <ul class="children"></ul>
    </li>
  </template>

  <dialog id="edit-dialog">
    <form method="dialog" class="edit-form" id="edit-form">
      <h3 id="edit-title">Add Node</h3>
      <label>Parent node ID
        <input name="parentId" id="f-parent" placeholder="root for top-level"/>
      </label>
      <label>Type
        <select name="type" id="f-type">
          <option value="prompt">prompt</option>
          <option value="snippet">snippet</option>
          <option value="checklist">checklist</option>
          <option value="template">template</option>
          <option value="link">link</option>
          <option value="group">group</option>
        </select>
      </label>
      <label>Title <input name="title" id="f-title" required /></label>
      <label>Summary <input name="summary" id="f-summary" /></label>
      <label>Prompt / Content
        <textarea name="prompt" id="f-prompt" rows="6"></textarea>
      </label>
      <label>Tags (comma-separated)
        <input name="tags" id="f-tags" placeholder="layout, accessibility" />
      </label>
      <label>Colour (optional hex or token)
        <input name="color" id="f-color" placeholder="#66d9ef or accent/good/warn/bad" />
      </label>
      <div class="dialog-actions">
        <button value="cancel">Cancel</button>
        <button id="btn-save" value="default">Save</button>
      </div>
    </form>
  </dialog>

  <div id="toast" role="status" aria-live="polite"></div>

  <script src="./app.js?v=9"></script><!-- plain script, global store -->
  <script src="./map.js?v=5"></script>
  <script>
    if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js'); }
    // Tab wiring
    const setView = v => {
      document.getElementById('view-list').setAttribute('aria-hidden', v!=='list');
      document.getElementById('view-map').setAttribute('aria-hidden', v!=='map');
      document.getElementById('tab-list').setAttribute('aria-selected', v==='list');
      document.getElementById('tab-map').setAttribute('aria-selected', v==='map');
      if(v==='map' && window.renderMindMap) window.renderMindMap(); // (re)draw
    };
    document.getElementById('tab-list').onclick = ()=>setView('list');
    document.getElementById('tab-map').onclick  = ()=>setView('map');
  </script>
</body>
</html>
